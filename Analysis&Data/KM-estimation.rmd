---
title: "Survival Analysis using Kaplan-Meier method"
output: html_document
---
## Load required packages

```{r setup, warning=FALSE, message=FALSE,}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
#install.packages(c("survival"))
library(survival)
```

## Data
First lets read data from the data.csv file.
```{r, warning=FALSE, message=FALSE}
a_data <- read.csv('data.csv', stringsAsFactors = TRUE)
```

## Dichotomize and change data labels

```{r}
a_data$major_releases <- car::recode(a_data$major_releases, "0 = 'No'; 1 = 'Yes'")
a_data$multi_repo <- car::recode(a_data$multi_repo, "0 = 'No'; 1 = 'Yes'") 
a_data$developers_count <- car::recode(a_data$author_count, "0:20 = '< 20'; 21:max(a_data$author_count) = '> 20'")
```

                     
## Kaplan-Meier method
The Kaplan-Meier method is the most common way to estimate survival times and probabilities. It is a non-parametric approach that results in a step function, where there is a step down each time an event occurs.

The Surv function from the survival package creates a survival object for use as the response in a model formula. There will be one entry for each subject that is the survival time, which is followed by a +. In other words, this is basically a compiled version of the duration and status columns that can be interpreted by the survfit function. A + behind survival times indicates censored data points.

```{r, warning=FALSE, message=FALSE}
surv_object <- Surv(time = a_data$duration, event = a_data$status)
```

The survfit function creates survival curves based on a formula. The next step is to fit the Kaplan-Meier curves. we can easily do that by passing the surv_object to the survfit function. Letâ€™s generate the overall survival curve for the entire cohort, assign it to object fit1 

```{r, warning=FALSE, message=FALSE, results='hide'}
fit1 <- survfit(surv_object ~ 1, data = a_data)
summary(fit1)

ggsurvplot(fit1, data = a_data, pval = TRUE, conf.int = TRUE)
```



Now. lets stratify the curve depending on the major releases
```{r, warning=FALSE, message=FALSE, results='hide'}
fit2 <- survfit(surv_object ~ major_releases, data = a_data)
summary(fit2)

ggsurvplot(fit2, data = a_data, pval = TRUE, conf.int = TRUE)
```


Next, lets stratify the curve depending on thehost types
```{r, warning=FALSE, message=FALSE, results='hide'}
fit3 <- survfit(surv_object ~ host_type, data = a_data)
summary(fit3)
ggsurvplot(fit3, data = a_data, pval = TRUE, conf.int = TRUE)
```



Now. lets stratify the curve depending if the projects had multiple repositories
```{r, warning=FALSE, message=FALSE, results='hide'}
fit4 <- survfit(surv_object ~ multi_repo, data = a_data)
summary(fit4)
ggsurvplot(fit4, data = a_data, pval = TRUE, conf.int = TRUE)
```


at last, lets stratify the curve depending on the author count
```{r, warning=FALSE, message=FALSE, results='hide'}
fit5 <- survfit(surv_object ~ developers_count, data = a_data)
summary(fit5)
ggsurvplot(fit5, data = a_data, pval = TRUE, conf.int = TRUE, legend.labs = c("author count <= 20", "author count > 20"))
```

